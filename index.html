<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delícias Urbanas - App de Pedidos com IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lobster+Two:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; [span_0](start_span)}
        .font-brand { font-family: 'Lobster Two', cursive; }[span_0](end_span)
        .menu-option-card:has(input:checked) { border-color: #2563eb; background-color: #eff6ff; transform: scale(1.02); [span_1](start_span)}
        .menu-option-card:has(input:checked) .checkmark { opacity: 1; }[span_1](end_span)
        .fade-in { animation: fadeIn 0.5s ease-in-out; [span_2](start_span)}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }[span_2](end_span)
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #3498db; width: 40px; height: 40px; animation: spin 2s linear infinite; [span_3](start_span)}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }[span_3](end_span)
        [span_4](start_span).no-print { }[span_4](end_span)
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: opacity 0.3s ease; [span_5](start_span)}
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); max-height: 90vh; overflow-y: auto; width: 90%; max-width: 500px; }[span_5](end_span)
        input:read-only { background-color: #f3f4f6; cursor: not-allowed; [span_6](start_span)}

        #print-report { display: none; }[span_6](end_span)
        @media print {
            @page { size: A4 portrait; margin: 15mm; [span_7](start_span)}
            .no-print { display: none !important; }[span_7](end_span)
            body > *:not(#print-report) { display: none !important; [span_8](start_span)}
            #print-report { display: block !important; }[span_8](end_span)
            #print-report h1 { font-size: 20pt; text-align: center; margin-bottom: 12px; font-family: 'Poppins', sans-serif; [span_9](start_span)}
            #print-report .report-day-section { margin-bottom: 20px; page-break-inside: avoid; }[span_9](end_span)
            #print-report .report-table { width: 100%; border-collapse: collapse; font-size: 10pt; [span_10](start_span)}
            #print-report th, #print-report td { border: 1px solid #ccc; padding: 6px; text-align: left; }[span_10](end_span)
            #print-report th { background-color: #e2e8f0; font-weight: 600; [span_11](start_span)}
            #print-report .rgf-col { width: 15%; } #print-report .nome-col { width: 60%; } #print-report .pedido-col { width: 25%; background-color: #dbeafe; font-weight: bold; }[span_11](end_span)
        }
        
        #app-toast {
            [span_12](start_span)position: fixed;[span_12](end_span)
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 2000;
            [span_13](start_span)opacity: 0;[span_13](end_span)
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none;
            [span_14](start_span)transform: translateX(-50%) translateY(20px);[span_14](end_span)
        }
        #app-toast.show {
            [span_15](start_span)opacity: 1;[span_15](end_span)
            pointer-events: auto;
            transform: translateX(-50%) translateY(0);
        }
        #app-toast.success { background-color: #22c55e; [span_16](start_span)}
        #app-toast.error { background-color: #ef4444; }[span_16](end_span)
        #app-toast.info { background-color: #3b82f6; [span_17](start_span)}
    </style>
</head>
<body class="bg-slate-50">

    <div id="app-container" class="container mx-auto max-w-4xl p-4 sm:p-6 pb-20">
        
        <div id="user-view" class="no-print">
            <div id="form-container">
                <header class="text-center mb-8"><h1 class="font-brand text-5xl text-blue-600">Delícias Urbanas</h1><p class="mt-2 text-md text-gray-500">O seu cardápio da semana está servido!</p></header>
                
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">[span_17](end_span)
                    <h2 class="block text-lg font-semibold text-gray-800 mb-2">👋 1. Identificação</h2>
                    <div class="grid sm:grid-cols-2 gap-4">
                        [span_18](start_span)<div><label for="employeeRGF" class="block text-sm font-medium text-gray-700">Seu RGF</label><input type="text" id="employeeRGF" placeholder="Digite o seu RGF" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg"></div>[span_18](end_span)
                        <div><label for="employeeName" class="block text-sm font-medium text-gray-700">Nome Completo</label><input type="text" id="employeeName" placeholder="Preenchido automaticamente" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg" readonly></div>
                    </div>
                </div>

                [span_19](start_span)<div class="bg-white rounded-xl shadow-sm p-6 mb-6"><h2 class="text-lg font-semibold text-gray-800 mb-4">🍔 2. Escolha os seus pratos</h2><div id="menu" class="space-y-8"><div class="text-center text-gray-500">A carregar o cardápio...</div></div></div>[span_19](end_span)
                <div id="guidanceSection" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mb-6"><p id="guidanceText" class="font-semibold">Digite seu RGF e escolha uma opção para cada dia.</p></div>
                <div id="submitButtonContainer" class="hidden text-center"><button id="openConfirmationModal" class="w-full sm:w-auto bg-green-500 text-white font-bold text-lg px-8 py-3 rounded-xl hover:bg-green-600 shadow-lg">Revisar e Finalizar Pedido</button></div>
            [span_20](start_span)</div>[span_20](end_span)
            [span_21](start_span)<div id="success-message" class="hidden text-center p-10 bg-white rounded-lg shadow-lg"><h2 class="text-3xl font-bold text-green-500">Pedido Enviado com Sucesso!</h2><p id="success-text" class="mt-4 text-gray-600"></p><button onclick="location.reload()" class="mt-6 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">Fazer Novo Pedido</button></div>[span_21](end_span)
            <footer class="text-center mt-10">
                <button id="switchToAdmin" class="text-sm text-gray-500 hover:text-blue-600">Aceder ao Painel do Administrador</button>
            </footer>
        [span_22](start_span)</div>[span_22](end_span)

        <div id="admin-view" class="hidden no-print">
            <header class="text-center border-b pb-6 mb-6">
                <h1 class="text-4xl font-bold text-gray-800">Painel do Administrador</h1>
                <p class="text-lg text-gray-600 mt-1">Delícias Urbanas</p>
                <div class="mt-4">
                    [span_23](start_span)<button id="adminLogoutBtn" class="bg-red-500 text-white text-sm px-4 py-2 rounded-lg hover:bg-red-600">Sair do Painel</button>[span_23](end_span)
                </div>
            </header>
            <div class="mb-8">
                <button id="switchToUserFromAdmin" class="text-sm text-gray-500 hover:text-blue-600">⬅️ Voltar para o Cardápio (Visão Usuário)</button>
            </div>
            
            <section id="status-panel-section" class="bg-white rounded-xl shadow-sm p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">📈 Status dos Pedidos</h2>
                <div id="status-panel-content" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-blue-100 p-4 rounded-lg"><p class="text-sm text-blue-800 font-semibold">Total de Funcionários</p><p id="total-employees" class="text-3xl font-bold text-blue-900">--</p></div>
                    <div class="bg-green-100 p-4 rounded-lg"><p class="text-sm text-green-800 font-semibold">Pedidos Feitos</p><p id="orders-made" class="text-3xl font-bold text-green-900">--</p></div>
                    <div class="bg-yellow-100 p-4 rounded-lg"><p class="text-sm text-yellow-800 font-semibold">Pedidos Pendentes</p><p id="orders-pending" class="text-3xl font-bold text-yellow-900">--</p></div>
                </div>
            </section>
            [span_24](start_span)<section id="employee-management-section" class="bg-white rounded-xl shadow-sm p-6 mb-8">[span_24](end_span)
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">👥 Gerenciamento de Funcionários</h2>
                <form id="add-employee-form" class="grid sm:grid-cols-3 gap-4 items-end mb-6">
                    <div>
                        [span_25](start_span)<label for="newEmployeeRGF" class="block text-sm font-medium text-gray-700">RGF</label>[span_25](end_span)
                        <input type="text" id="newEmployeeRGF" placeholder="RGF do funcionário" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        [span_26](start_span)<label for="newEmployeeName" class="block text-sm font-medium text-gray-700">Nome Completo</label>[span_26](end_span)
                        <input type="text" id="newEmployeeName" placeholder="Nome do funcionário" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    [span_27](start_span)<button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Adicionar Funcionário</button>[span_27](end_span)
                </form>
                <div id="employee-list-container" class="overflow-x-auto">
                    <p class="text-gray-500">A carregar lista de funcionários...</p>
                </div>
            </section>

            [span_28](start_span)<section id="menu-updater-section" class="bg-white rounded-xl shadow-sm p-6 mb-8">[span_28](end_span)
                 <h2 class="text-2xl font-semibold text-gray-700 mb-4">🍜 Atualizar Cardápio com Imagem (IA)</h2>
                <p class="text-gray-600 mb-4">Envie uma imagem do novo cardápio. [span_29](start_span)A nossa inteligência artificial irá ler e preencher os campos para si.</p>[span_29](end_span)
                <input type="file" id="imageUpload" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                <img id="imagePreview" class="mt-4 rounded-lg max-h-80 hidden" />
                <div id="image-processor-container" class="mt-4 text-center hidden"><button id="processImageBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Analisar Cardápio</button></div>
                [span_30](start_span)<div id="loader" class="hidden mx-auto my-4 loader"></div>[span_30](end_span)
                <div id="confirmation-form" class="hidden mt-6"></div>
                <div id="whatsapp-announcer" class="mt-6 text-center hidden"><button id="announceOnWhatsAppBtn" class="w-full sm:w-auto bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600">📢 Anunciar Cardápio no WhatsApp</button></div>
                </section>
            
            <section id="dashboard-section" class="bg-white rounded-xl shadow-sm p-6 mb-8">
                [span_31](start_span)<h2 class="text-2xl font-semibold text-gray-700 mb-4">📊 Dashboard de Totais da Semana</h2>[span_31](end_span)
                <div id="admin-dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><p class="text-gray-500">A calcular totais...</p></div>
            </section>

            <section id="orders-section">
                <div class="mb-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <h2 class="text-2xl font-semibold text-gray-700">Pedidos Recebidos</h2>
                    [span_32](start_span)<div class="w-full sm:w-auto"><input type="text" id="searchInput" placeholder="🔎 Buscar por nome..." class="w-full sm:w-64 px-4 py-2 border rounded-lg"></div>[span_32](end_span)
                    <button id="generateReportBtn" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 shadow-lg">🖨️ Salvar Relatório como PDF</button>
                </div>
                [span_33](start_span)<div id="ordersTableContainer" class="overflow-x-auto"><p class="text-gray-500">A carregar pedidos...</p></div>[span_33](end_span)
            </section>
        </div>
    </div>

    <div id="edit-order-modal" class="modal-overlay hidden no-print"><div class="modal-content"><h2 class="text-2xl font-bold mb-4">Editar Pedido</h2><form id="edit-order-form"><input type="hidden" id="edit-order-id"><div class="mb-4"><label class="block text-lg font-semibold text-gray-800 mb-2">Nome do Funcionário</label><input type="text" id="edit-order-employeeName" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly></div><div id="edit-menu-options" class="space-y-6"></div><div class="mt-6 flex justify-end space-x-4"><button type="button" class="cancel-modal-btn px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancelar</button><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Salvar Alterações</button></div></form></div></div>
    [span_34](start_span)<div id="edit-employee-modal" class="modal-overlay hidden no-print"><div class="modal-content"><h2 class="text-2xl font-bold mb-4">Editar Funcionário</h2><form id="edit-employee-form"><div class="mb-4"><label for="editEmployeeRGF" class="block text-sm font-medium text-gray-700">RGF</label><input type="text" id="editEmployeeRGF" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg" readonly></div><div class="mb-4"><label for="editEmployeeName" class="block text-sm font-medium text-gray-700">Nome Completo</label><input type="text" id="editEmployeeName" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg" required></div><div class="mt-6 flex justify-end space-x-4"><button type="button" class="cancel-modal-btn px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancelar</button><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Salvar Alterações</button></div></form></div></div>[span_34](end_span)
    <div id="confirmation-modal" class="modal-overlay hidden no-print"><div class="modal-content fade-in"><h2 class="text-2xl font-bold mb-4">Confirme o seu Pedido</h2><p class="mb-6 text-gray-600">Por favor, revise as suas escolhas antes de enviar.</p><div id="confirmation-summary" class="space-y-2 mb-8"></div><div class="flex justify-end space-x-4"><button type="button" class="cancel-modal-btn px-6 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Editar</button><button id="submitOrder" class="px-6 py-2 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600">Confirmar e Enviar</button></div></div></div>
    [span_35](start_span)<div id="admin-login-modal" class="modal-overlay hidden no-print"><div class="modal-content"><h2 class="text-2xl font-bold mb-4">Aceder ao Painel de Administrador</h2><form id="admin-login-form"><div class="mb-4"><label for="adminEmail" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="adminEmail" placeholder="seu-email@exemplo.com" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg" required></div><div class="mb-4"><label for="adminPassword" class="block text-sm font-medium text-gray-700">Senha</label><input type="password" id="adminPassword" placeholder="Sua senha" class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg" required></div><div class="mt-6 flex justify-end space-x-4"><button type="button" class="cancel-modal-btn px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancelar</button><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Entrar</button></div></form></div></div>[span_35](end_span)
    [span_36](start_span)<div id="custom-confirm-modal" class="modal-overlay hidden no-print"><div class="modal-content fade-in"><h2 class="text-xl font-bold mb-4" id="custom-confirm-title">Confirmar Ação</h2><p class="mb-6 text-gray-600" id="custom-confirm-message">Tem a certeza que deseja prosseguir?</p><div class="flex justify-end space-x-4"><button id="custom-confirm-cancel-btn" class="px-6 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancelar</button><button id="custom-confirm-ok-btn" class="px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700">Confirmar</button></div></div></div>[span_36](end_span)

    <div id="print-report"></div>
    <div id="app-toast"></div>
    
    <script type="module">
        [span_37](start_span)import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";[span_37](end_span)
        [span_38](start_span)import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, doc, getDoc, setDoc, deleteDoc, updateDoc, getCountFromServer } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";[span_38](end_span)
        [span_39](start_span)import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";[span_39](end_span)
        
        const firebaseConfig = {
            apiKey: "AIzaSyDa24jUk24wjlMsJUC4uXwnbmxM4vCtocI",
            authDomain: "cardapio-8ddea.firebaseapp.com",
            projectId: "cardapio-8ddea",
            storageBucket: "cardapio-8ddea.appspot.com",
            messagingSenderId: "1019677985212",
            appId: "1:1019677985212:web:57c7820a62585a867dc3b9"
        [span_40](start_span)};[span_40](end_span)
        [span_41](start_span)const app = initializeApp(firebaseConfig);[span_41](end_span)
        [span_42](start_span)const db = getFirestore(app);[span_42](end_span)
        [span_43](start_span)const auth = getAuth(app);[span_43](end_span)
        
        const APP_CONFIG = {
            ADMIN_UID: 'LqAXao4FuOQAvzS3uQAd9et6OnK2',
        [span_44](start_span)};[span_44](end_span)
        
        [span_45](start_span)const menuDocRef = doc(db, "cardapio", "semanal");[span_45](end_span)
        [span_46](start_span)const pedidosCollectionRef = collection(db, "pedidosDaSemana");[span_46](end_span)
        [span_47](start_span)const funcionariosCollectionRef = collection(db, "funcionarios");[span_47](end_span)
        
        [span_48](start_span)const fixedOptions = [{ name: 'Omelete', emoji: '🍳' }, { name: 'Filé de frango', emoji: '🍗' }];[span_48](end_span)
        [span_49](start_span)let weeklyMenu = [];[span_49](end_span)
        [span_50](start_span)let allOrders = [];[span_50](end_span)
        let totalEmployees = 0;
        [span_51](start_span)let tempOrderData = {};[span_51](end_span)
        
        function getDayId(dayName) { return dayName.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z]/g, "").toLowerCase(); [span_52](start_span)}

        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.getElementById('app-toast');[span_52](end_span)
            [span_53](start_span)if(!toast) return;[span_53](end_span)
            toast.textContent = message;
            toast.className = 'show';
            toast.classList.add(type);
            [span_54](start_span)setTimeout(() => { toast.className = toast.className.replace('show', ''); }, duration);[span_54](end_span)
        }
        
        function showCustomConfirm(message, onConfirm) {
            [span_55](start_span)const modal = document.getElementById('custom-confirm-modal');[span_55](end_span)
            [span_56](start_span)const messageEl = document.getElementById('custom-confirm-message');[span_56](end_span)
            const okBtn = document.getElementById('custom-confirm-ok-btn');
            
            messageEl.textContent = message;
            modal.classList.remove('hidden');

            const newOkBtn = okBtn.cloneNode(true);
            [span_57](start_span)okBtn.parentNode.replaceChild(newOkBtn, okBtn);[span_57](end_span)
            newOkBtn.addEventListener('click', () => {
                onConfirm();
                modal.classList.add('hidden');
            [span_58](start_span)});[span_58](end_span)
        }
        
        function updateStatusPanel(ordersCount) {
            const totalEl = document.getElementById('total-employees');
            const madeEl = document.getElementById('orders-made');
            const pendingEl = document.getElementById('orders-pending');
            
            if (totalEmployees > 0) {
                const pendingCount = totalEmployees - ordersCount;
                totalEl.textContent = totalEmployees;
                madeEl.textContent = ordersCount;
                pendingEl.textContent = pendingCount >= 0 ? pendingCount : 0;
            } else {
                totalEl.textContent = '--';
                madeEl.textContent = ordersCount;
                pendingEl.textContent = '--';
            }
        }

        async function getTotalEmployees() {
            try {
                const snapshot = await getCountFromServer(funcionariosCollectionRef);
                totalEmployees = snapshot.data().count;
            } catch (error) {
                console.error("Erro ao contar funcionários:", error);
                totalEmployees = 0;
            }
        }

        function loadAndRenderEmployees() {
            [span_59](start_span)const q = query(funcionariosCollectionRef, orderBy("nome"));[span_59](end_span)
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('employee-list-container');
                totalEmployees = snapshot.size;
                updateStatusPanel(allOrders.length);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum funcionário cadastrado.</p>';
                    return;
                [span_60](start_span)}
                let tableHTML = `<table class="min-w-full bg-white border"><thead><tr class="bg-gray-50"><th class="py-2 px-3 border-b text-left">RGF</th><th class="py-2 px-3 border-b text-left">Nome</th><th class="py-2 px-3 border-b text-left">Ações</th></tr></thead><tbody>`;
                snapshot.forEach(doc => {
                    const employee = doc.data();
                    tableHTML += `<tr>
                        <td class="py-2 px-3 border-b font-mono">${doc.id}</td>
                        <td class="py-2 px-3 border-b font-semibold">${employee.nome}</td>
                        <td class="py-2 px-3 border-b space-x-2">
                            <button data-id="${doc.id}" data-name="${employee.nome}" class="edit-employee-btn text-blue-600 hover:text-blue-800 text-sm font-semibold">Editar</button>
                            <button data-id="${doc.id}" data-name="${employee.nome}" class="delete-employee-btn text-red-600 hover:text-red-800 text-sm font-semibold">Excluir</button>
                        </td>
                    </tr>`;[span_60](end_span)
                });
                tableHTML += '</tbody></table>';
                container.innerHTML = tableHTML;
            }, (error) => {
                 [span_61](start_span)console.error("Erro ao carregar funcionários:", error);[span_61](end_span)
                 [span_62](start_span)showToast("Falha ao carregar funcionários. Verifique o console para mais detalhes.", "error");[span_62](end_span)
            [span_63](start_span)});[span_63](end_span)
        }

        async function handleAddEmployee(e) {
            [span_64](start_span)e.preventDefault();[span_64](end_span)
            [span_65](start_span)const rgfInput = document.getElementById('newEmployeeRGF');[span_65](end_span)
            [span_66](start_span)const nameInput = document.getElementById('newEmployeeName');[span_66](end_span)
            [span_67](start_span)const rgf = rgfInput.value.trim();[span_67](end_span)
            [span_68](start_span)const nome = nameInput.value.trim();[span_68](end_span)
            if (!rgf || !nome) { showToast("Por favor, preencha o RGF e o Nome.", 'error'); return; [span_69](start_span)}

            try {
                await setDoc(doc(db, "funcionarios", rgf), { nome });[span_69](end_span)
                [span_70](start_span)showToast("Funcionário adicionado com sucesso!", 'success');[span_70](end_span)
                [span_71](start_span)rgfInput.value = ''; nameInput.value = '';[span_71](end_span)
            } catch (error) {
                [span_72](start_span)console.error("Erro ao adicionar funcionário: ", error);[span_72](end_span)
                [span_73](start_span)showToast("Ocorreu um erro ao adicionar o funcionário.", 'error');[span_73](end_span)
            }
        }

        function handleDeleteEmployee(rgf, name) {
            const message = `Tem a certeza que deseja excluir o funcionário ${name} (RGF: ${rgf})? [span_74](start_span)Esta ação não pode ser desfeita.`;[span_74](end_span)
            showCustomConfirm(message, async () => {
                try {
                    await deleteDoc(doc(db, "funcionarios", rgf));
                    showToast("Funcionário excluído com sucesso.", 'success');
                } catch (error) {
                    [span_75](start_span)console.error("Erro ao excluir funcionário: ", error);[span_75](end_span)
                    [span_76](start_span)showToast("Falha ao excluir o funcionário.", 'error');[span_76](end_span)
                }
            [span_77](start_span)});[span_77](end_span)
        }
        
        function openEmployeeEditModal(rgf, nome) {
            [span_78](start_span)document.getElementById('editEmployeeRGF').value = rgf;[span_78](end_span)
            [span_79](start_span)document.getElementById('editEmployeeName').value = nome;[span_79](end_span)
            document.getElementById('edit-employee-modal').classList.remove('hidden');
        }

        async function handleSaveEmployeeChanges(e) {
            [span_80](start_span)e.preventDefault();[span_80](end_span)
            [span_81](start_span)const rgf = document.getElementById('editEmployeeRGF').value;[span_81](end_span)
            const newName = document.getElementById('editEmployeeName').value.trim();

            if (!newName) { showToast("O nome não pode ficar em branco.", 'error'); return; [span_82](start_span)}
            try {
                await updateDoc(doc(db, "funcionarios", rgf), { nome: newName });[span_82](end_span)
                [span_83](start_span)showToast("Funcionário atualizado com sucesso!", 'success');[span_83](end_span)
                document.getElementById('edit-employee-modal').classList.add('hidden');
            } catch (error) {
                [span_84](start_span)console.error("Erro ao salvar alterações do funcionário: ", error);[span_84](end_span)
                [span_85](start_span)showToast("Falha ao salvar as alterações do funcionário.", 'error');[span_85](end_span)
            }
        }
        
        async function findEmployeeByRGF(rgf) {
            [span_86](start_span)const nameInput = document.getElementById('employeeName');[span_86](end_span)
            if (!rgf) { nameInput.value = ''; nameInput.placeholder = 'Preenchido automaticamente'; validateForm(); return; [span_87](start_span)}
            try {
                const docSnap = await getDoc(doc(db, "funcionarios", rgf));[span_87](end_span)
                if (docSnap.exists()) {
                    [span_88](start_span)nameInput.value = docSnap.data().nome;[span_88](end_span)
                } else {
                    [span_89](start_span)nameInput.value = '';[span_89](end_span)
                    [span_90](start_span)nameInput.placeholder = 'RGF não encontrado';[span_90](end_span)
                }
                [span_91](start_span)validateForm();[span_91](end_span)
            } catch (error) {
                [span_92](start_span)console.error("Erro ao buscar funcionário:", error);[span_92](end_span)
                [span_93](start_span)nameInput.value = ''; nameInput.placeholder = 'Erro na busca';[span_93](end_span)
                [span_94](start_span)showToast("Erro ao buscar funcionário.", 'error');[span_94](end_span)
            }
        }
        
        function createFallbackMenu() {
            [span_95](start_span)const days = ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira'];[span_95](end_span)
            [span_96](start_span)return days.map(day => ({ day, isHoliday: false, pratoPrincipal: { name: 'Cardápio não definido', emoji: '🗓️' }, opcao: { name: '', emoji: '' }, guarnicao: { name: 'A definir', emoji: '' } }));[span_96](end_span)
        }

        function loadAndDisplayMenu() {
            onSnapshot(menuDocRef, (docSnap) => {
                weeklyMenu = (docSnap.exists() && docSnap.data().menu?.length > 0) ? docSnap.data().menu : createFallbackMenu();
                createMenuHTML();
                document.getElementById('whatsapp-announcer')?.classList.toggle('hidden', !docSnap.exists() || weeklyMenu.length === 0);
            }, (error) => {
                 [span_97](start_span)console.error("Erro ao carregar o cardápio:", error);[span_97](end_span)
                 [span_98](start_span)showToast("Erro ao carregar o cardápio. Usando cardápio padrão.", 'error');[span_98](end_span)
                 [span_99](start_span)weeklyMenu = createFallbackMenu();[span_99](end_span)
                 [span_100](start_span)createMenuHTML();[span_100](end_span)
            });
        }
        
        function createMenuHTML() {
            [span_101](start_span)const menuContainer = document.getElementById('menu');[span_101](end_span)
            [span_102](start_span)if (!menuContainer) return;[span_102](end_span)
            menuContainer.innerHTML = '';

            weeklyMenu.forEach(item => {
                const dayId = getDayId(item.day);
                let dayHTML = `<div class="day-section space-y-3">`;

                if (item.isHoliday) {
                    [span_103](start_span)dayHTML += `<h3 class="text-xl font-bold text-gray-800">${item.day}</h3><div class="bg-indigo-100 border-l-4 border-indigo-500 text-indigo-700 p-4 rounded-md"><p class="font-bold">🎉 Feriado</p><p>Não haverá refeição neste dia.</p></div>`;[span_103](end_span)
                } else {
                    const allOptions = [
                        { ...item.pratoPrincipal, type: 'Prato Principal', isSpecial: item.pratoPrincipal.isSpecial },
                        ...(item.opcao?.name ? [{ ...item.opcao, type: 'Opção do Dia', isSpecial: item.opcao.isSpecial }] : []),
                        ...fixedOptions.map(fixa => ({ ...fixa, type: 'Opção Fixa' })),
                    [span_104](start_span)];[span_104](end_span)
                    [span_105](start_span)dayHTML += `<h3 class="text-xl font-bold text-gray-800">${item.day}</h3>`;[span_105](end_span)
                    if (item.guarnicao?.name) {
                        [span_106](start_span)dayHTML += `<div class="text-sm font-semibold text-blue-600 bg-blue-100 rounded-full inline-block px-3 py-1 mb-3">Guarnição: ${item.guarnicao.name} ${item.guarnicao.emoji}</div>`;[span_106](end_span)
                    }
                    
                    [span_107](start_span)dayHTML += `<div class="space-y-3">`;[span_107](end_span)
                    allOptions.forEach((option) => {
                        if (option.name) {
                            const specialBadge = option.isSpecial ? '<span class="text-yellow-500" title="Almoço Especial">⭐</span>' : '';
                            [span_108](start_span)dayHTML += `<label class="menu-option-card block p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition-transform duration-200"><input type="radio" name="${dayId}" value="${option.name}" class="hidden"><div class="flex items-center"><span class="text-3xl mr-4">${option.emoji}</span><div class="flex-grow"><p class="font-semibold text-gray-800">${option.name} ${specialBadge}</p><p class="text-sm text-gray-500">${option.type}</p></div><svg xmlns="http://www.w3.org/2000/svg" class="checkmark h-6 w-6 text-blue-600 opacity-0 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7" /></svg></div></label>`;[span_108](end_span)
                        }
                    });
                    [span_109](start_span)dayHTML += `</div>`;[span_109](end_span)
                    
                    [span_110](start_span)dayHTML += `<div class="mt-3"><textarea id="notes-${dayId}" name="notes-${dayId}" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Anotações? Ex: sem cebola, ponto da carne, etc."></textarea></div>`;[span_110](end_span)
                }

                [span_111](start_span)dayHTML += `</div>`;[span_111](end_span)
                menuContainer.innerHTML += dayHTML;
            });

            validateForm();
        }

        function validateForm() {
            [span_112](start_span)const name = document.getElementById('employeeName')?.value.trim();[span_112](end_span)
            [span_113](start_span)const rgf = document.getElementById('employeeRGF')?.value.trim();[span_113](end_span)
            [span_114](start_span)const guidanceSection = document.getElementById('guidanceSection');[span_114](end_span)
            [span_115](start_span)const guidanceText = document.getElementById('guidanceText');[span_115](end_span)
            [span_116](start_span)const submitBtnContainer = document.getElementById('submitButtonContainer');[span_116](end_span)
            [span_117](start_span)if (!guidanceSection || !submitBtnContainer) return;[span_117](end_span)

            [span_118](start_span)const nonHolidayItems = weeklyMenu.filter(item => !item.isHoliday);[span_118](end_span)
            [span_119](start_span)const hasAllSelections = nonHolidayItems.length > 0 && nonHolidayItems.every(item => document.querySelector(`input[name="${getDayId(item.day)}"]:checked`));[span_119](end_span)
            if (name && rgf && hasAllSelections) {
                [span_120](start_span)guidanceSection.classList.add('hidden');[span_120](end_span)
                [span_121](start_span)submitBtnContainer.classList.remove('hidden');[span_121](end_span)
            } else {
                [span_122](start_span)submitBtnContainer.classList.add('hidden');[span_122](end_span)
                [span_123](start_span)guidanceSection.classList.remove('hidden');[span_123](end_span)
                let message = '';
                if(!rgf) message = 'Digite seu RGF para começar. [span_124](start_span)';[span_124](end_span)
                else if(!name) message = 'RGF não encontrado. Peça para um administrador cadastrá-lo. [span_125](start_span)';[span_125](end_span)
                else if (!hasAllSelections) {
                    const missingDays = nonHolidayItems
                        .filter(item => !document.querySelector(`input[name="${getDayId(item.day)}"]:checked`))
                        [span_126](start_span).map(item => item.day);[span_126](end_span)
                    [span_127](start_span)if (missingDays.length > 0) message += `Falta selecionar opções para: ${missingDays.join(', ')}.`;[span_127](end_span)
                }
                guidanceText.textContent = message || [span_128](start_span)'Por favor, preencha todos os campos.';[span_128](end_span)
            }
        }

        function openConfirmationModal() {
            tempOrderData = {
                employeeName: document.getElementById('employeeName').value.trim(),
                employeeRGF: document.getElementById('employeeRGF').value.trim(),
                timestamp: serverTimestamp()
            [span_129](start_span)};[span_129](end_span)
            const summaryContainer = document.getElementById('confirmation-summary');
            summaryContainer.innerHTML = '';
            
            weeklyMenu.forEach(item => {
                const dayId = getDayId(item.day);
                
                if (!item.isHoliday) {
                    [span_130](start_span)const choiceInput = document.querySelector(`input[name="${dayId}"]:checked`);[span_130](end_span)
                    if (!choiceInput) return;
                    const choice = choiceInput.value;
                    const notes = document.getElementById(`notes-${dayId}`).value.trim();

                    [span_131](start_span)tempOrderData[dayId] = choice;[span_131](end_span)
                    if(notes) {
                        tempOrderData[`${dayId}_notes`] = notes;
                    }

                    summaryContainer.innerHTML += `<p><span class="font-bold">${item.day}:</span> ${choice} ${notes ? [span_132](start_span)`<span class="text-sm text-gray-500 italic">(${notes})</span>` : ''}</p>`;[span_132](end_span)
                }
            [span_133](start_span)});[span_133](end_span)
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }

        async function submitOrder() {
            [span_134](start_span)const button = document.getElementById('submitOrder');[span_134](end_span)
            [span_135](start_span)button.disabled = true; button.textContent = 'A enviar...';[span_135](end_span)
            try {
                [span_136](start_span)await addDoc(pedidosCollectionRef, tempOrderData);[span_136](end_span)
                document.getElementById('confirmation-modal').classList.add('hidden');
                document.getElementById('form-container').classList.add('hidden');
                document.getElementById('success-text').textContent = `Obrigado, ${tempOrderData.employeeName}. O seu pedido foi registado com sucesso.`;
                document.getElementById('success-message').classList.remove('hidden');
                [span_137](start_span)showToast("Pedido enviado com sucesso!", 'success');[span_137](end_span)
            } catch (error) {
                [span_138](start_span)console.error("Erro ao enviar pedido: ", error);[span_138](end_span)
                [span_139](start_span)showToast("Ocorreu um erro ao enviar o seu pedido.", 'error');[span_139](end_span)
            } finally {
                [span_140](start_span)button.disabled = false;[span_140](end_span)
                [span_141](start_span)button.textContent = 'Confirmar e Enviar';[span_141](end_span)
            }
        }
        
        function loadAdminData() {
            onSnapshot(pedidosCollectionRef, (snapshot) => {
                const latestOrdersMap = new Map();
                snapshot.forEach(doc => {
                    [span_142](start_span)const orderData = doc.data();[span_142](end_span)
                    if (orderData.employeeRGF) {
                        const timestamp = orderData.timestamp ? orderData.timestamp.toMillis() : 0;
                         if (!latestOrdersMap.has(orderData.employeeRGF) || timestamp > latestOrdersMap.get(orderData.employeeRGF).timestamp) {
                            [span_143](start_span)latestOrdersMap.set(orderData.employeeRGF, { doc: doc, timestamp: timestamp });[span_143](end_span)
                         }
                    }
                });
                
                allOrders = Array.from(latestOrdersMap.values())
                    .map(item => item.doc)
                    [span_144](start_span).sort((a, b) => a.data().employeeName.localeCompare(b.data().employeeName));[span_144](end_span)

                [span_145](start_span)updateDashboard(allOrders);[span_145](end_span)
                [span_146](start_span)renderOrdersTable(allOrders);[span_146](end_span)
                updateStatusPanel(allOrders.length);
            }, (error) => {
                [span_147](start_span)console.error("Erro ao carregar dados do administrador:", error);[span_147](end_span)
                [span_148](start_span)showToast("Erro ao carregar dados do administrador.", 'error');[span_148](end_span)
            });
        }

        function updateDashboard(orders) {
            [span_149](start_span)const dashboard = document.getElementById('admin-dashboard');[span_149](end_span)
            if (!weeklyMenu || weeklyMenu.length === 0) { dashboard.innerHTML = '<p class="text-gray-500">Cardápio semanal não carregado.</p>'; return; [span_150](start_span)}
            if (orders.length === 0) { dashboard.innerHTML = '<p class="text-gray-500">Nenhum pedido para calcular totais.</p>'; return; }[span_150](end_span)

            [span_151](start_span)const dailyCounts = {};[span_151](end_span)
            weeklyMenu.forEach(dayItem => {
                if(dayItem.isHoliday) return;
                dailyCounts[dayItem.day] = {};
                orders.forEach(orderDoc => {
                    const dayId = getDayId(dayItem.day);
                    [span_152](start_span)const choice = orderDoc.data()[dayId];[span_152](end_span)
                    if (choice) {
                        dailyCounts[dayItem.day][choice] = (dailyCounts[dayItem.day][choice] || 0) + 1;
                    }
                });
            [span_153](start_span)});[span_153](end_span)

            dashboard.innerHTML = '';
            Object.entries(dailyCounts).forEach(([day, counts]) => {
                let dayHTML = `<div class="p-4 bg-gray-50 rounded-lg"><h3 class="font-bold text-lg text-gray-800 mb-2">${day}</h3><div class="space-y-1">`;
                const sortedCounts = Object.entries(counts).sort(([,a],[,b]) => b - a);
                if (sortedCounts.length === 0) { dayHTML += `<p class="text-sm text-gray-500">Nenhum pedido neste dia.</p>`; } 
                [span_154](start_span)else { sortedCounts.forEach(([item, count]) => { dayHTML += `<div class="flex justify-between text-sm"><span class="text-gray-600">${item}</span><span class="font-semibold text-blue-700">${count}</span></div>`; }); }[span_154](end_span)
                dayHTML += '</div></div>';
                dashboard.innerHTML += dayHTML;
            [span_155](start_span)});[span_155](end_span)
        }

        function renderOrdersTable(orders) {
            [span_156](start_span)const container = document.getElementById('ordersTableContainer');[span_156](end_span)
            [span_157](start_span)const searchTerm = document.getElementById('searchInput').value.toLowerCase();[span_157](end_span)
            [span_158](start_span)const filteredOrders = orders.filter(doc => doc.data().employeeName.toLowerCase().includes(searchTerm));[span_158](end_span)
            if (filteredOrders.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum pedido encontrado.</p>'; return; [span_159](start_span)}
            if (!weeklyMenu || weeklyMenu.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center py-4">Aguardando cardápio...</p>'; return; }[span_159](end_span)

            [span_160](start_span)let tableHTML = `<table class="min-w-full bg-white border"><thead><tr class="bg-gray-50"><th class="py-2 px-3 border-b text-left">Funcionário</th><th class="py-2 px-3 border-b text-left">RGF</th>`;[span_160](end_span)
            [span_161](start_span)weeklyMenu.forEach(item => tableHTML += `<th class="py-2 px-3 border-b text-left">${item.day.substring(0,3)}</th>`);[span_161](end_span)
            tableHTML += `<th class="py-2 px-3 border-b text-left">Data/Hora do Pedido</th><th class="py-2 px-3 border-b text-left">Ações</th></tr></thead><tbody>`;
            filteredOrders.forEach(doc => {
                const order = doc.data();
                tableHTML += `<tr><td class="py-2 px-3 border-b font-bold">${order.employeeName}</td><td class="py-2 px-3 border-b">${order.employeeRGF || 'N/A'}</td>`;
                weeklyMenu.forEach(dayMenuItem => {
                    const dayId = getDayId(dayMenuItem.day);
                    [span_162](start_span)let cellContent = '';[span_162](end_span)

                    if (dayMenuItem.isHoliday) {
                        cellContent = '<span class="text-xs text-indigo-600">Feriado</span>';
                    } else {
                        let choice = order[dayId] || [span_163](start_span)'N/A';[span_163](end_span)
                        const specialBadge = (dayMenuItem.pratoPrincipal.name === choice && dayMenuItem.pratoPrincipal.isSpecial) || (dayMenuItem.opcao?.name === choice && dayMenuItem.opcao.isSpecial) ? ' ⭐' : '';
                        if (choice === dayMenuItem.pratoPrincipal.name) choice = 'Prato';
                        [span_164](start_span)else if (dayMenuItem.opcao?.name && choice === dayMenuItem.opcao.name) choice = 'Opção';[span_164](end_span)
                        
                        [span_165](start_span)const notes = order[`${dayId}_notes`];[span_165](end_span)
                        cellContent = choice + specialBadge;
                        if (notes) {
                            [span_166](start_span)cellContent += ` <span title="${notes}" class="cursor-help text-blue-500 font-bold">*</span>`;[span_166](end_span)
                        }
                    }
                    [span_167](start_span)tableHTML += `<td class="py-2 px-3 border-b">${cellContent}</td>`;[span_167](end_span)
                });
                const timestamp = order.timestamp ? order.timestamp.toDate().toLocaleString('pt-BR') : 'N/A';
                tableHTML += `<td class="py-2 px-3 border-b text-sm text-gray-600">${timestamp}</td>`;
                [span_168](start_span)tableHTML += `<td class="py-2 px-3 border-b space-x-2"><button data-id="${doc.id}" class="edit-order-btn text-blue-600 hover:text-blue-800 text-sm font-semibold">Editar</button><button data-id="${doc.id}" data-name="${order.employeeName}" class="delete-order-btn text-red-600 hover:text-red-800 text-sm font-semibold">Excluir</button></td></tr>`;[span_168](end_span)
            });
            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        }

        function generateAndPrintReport() {
            [span_169](start_span)const reportContainer = document.getElementById('print-report');[span_169](end_span)
            [span_170](start_span)reportContainer.innerHTML = '<h1>Relatório de Pedidos da Semana - Regional Quatinga</h1>';[span_170](end_span)
            weeklyMenu.forEach(dayMenuItem => {
                if (dayMenuItem.isHoliday) return;

                const dayId = getDayId(dayMenuItem.day);
                let tableHTML = `<div class="report-day-section"><table class="report-table"><thead><tr><th class="rgf-col">RGF</th><th class="nome-col">NOME</th><th class="pedido-col">${dayMenuItem.day}</th></tr></thead><tbody>`;
                
                const dailyOrders = allOrders
                    .filter(orderDoc => orderDoc.data()[dayId])
                    [span_171](start_span).sort((a,b) => a.data().employeeName.localeCompare(b.data().employeeName));[span_171](end_span)
                
                dailyOrders.forEach(orderDoc => {
                    [span_172](start_span)const order = orderDoc.data();[span_172](end_span)
                    let choice = order[dayId];
                    if (choice === dayMenuItem.pratoPrincipal.name) choice = 'Prato';
                    [span_173](start_span)else if (dayMenuItem.opcao?.name && choice === dayMenuItem.opcao.name) choice = 'Opção';[span_173](end_span)
                    [span_174](start_span)const notes = order[`${dayId}_notes`];[span_174](end_span)
                    let choiceHTML = choice;
                    if (notes) {
                        [span_175](start_span)choiceHTML += ` <span style="font-style: italic; font-weight: normal;">(${notes})</span>`;[span_175](end_span)
                    }

                    tableHTML += `<tr><td>${order.employeeRGF || [span_176](start_span)'N/A'}</td><td>${order.employeeName}</td><td>${choiceHTML}</td></tr>`;[span_176](end_span)
                });
                tableHTML += '</tbody></table></div>';
                reportContainer.innerHTML += tableHTML;
            });
            [span_177](start_span)window.print();[span_177](end_span)
        }
        
        // ... (demais funções do modal de edição e exclusão permanecem as mesmas) ...
        async function openOrderEditModal(docId) {
            [span_178](start_span)const modal = document.getElementById('edit-order-modal');[span_178](end_span)
            [span_179](start_span)const formContent = document.getElementById('edit-menu-options');[span_179](end_span)
            [span_180](start_span)const employeeNameInput = document.getElementById('edit-order-employeeName');[span_180](end_span)
            [span_181](start_span)const orderIdInput = document.getElementById('edit-order-id');[span_181](end_span)

            formContent.innerHTML = '<p class="text-center text-gray-500">A carregar...</p>';
            [span_182](start_span)modal.classList.remove('hidden');[span_182](end_span)
            try {
                [span_183](start_span)const docSnap = await getDoc(doc(db, "pedidosDaSemana", docId));[span_183](end_span)
                if (!docSnap.exists()) { showToast("Erro: Pedido não encontrado.", 'error'); modal.classList.add('hidden'); return; [span_184](start_span)}

                const orderData = docSnap.data();[span_184](end_span)
                [span_185](start_span)employeeNameInput.value = orderData.employeeName;[span_185](end_span)
                orderIdInput.value = docId;
                formContent.innerHTML = '';

                weeklyMenu.forEach(item => {
                    const dayId = getDayId(item.day);
                    let dayHTML = `<fieldset class="day-section border p-4 rounded-lg"><legend class="font-bold text-lg text-gray-800 px-2">${item.day}</legend>`;
                    
                    if(item.isHoliday) {
                        [span_186](start_span)dayHTML += `<div class="bg-indigo-100 text-indigo-700 p-3 rounded-md text-center">Feriado</div>`;[span_186](end_span)
                    } else {
                        const currentChoice = orderData[dayId];
                        const currentNotes = orderData[`${dayId}_notes`] || [span_187](start_span)'';[span_187](end_span)
                        const allOptions = [ { ...item.pratoPrincipal }, ...(item.opcao?.name ? [{ ...item.opcao }] : []), ...fixedOptions ];
                        
                        [span_188](start_span)dayHTML += `<div class="space-y-2 mt-2">`;[span_188](end_span)
                        allOptions.forEach((option, index) => {
                            if (option.name) {
                                [span_189](start_span)const uniqueId = `edit-${dayId}-${index}`;[span_189](end_span)
                                const isChecked = (option.name === currentChoice) ? [span_190](start_span)'checked' : '';[span_190](end_span)
                                dayHTML += `<div class="flex items-center"><input type="radio" id="${uniqueId}" name="${dayId}" value="${option.name}" class="h-4 w-4 text-blue-600 border-gray-300" ${isChecked} required><label for="${uniqueId}" class="ml-3 block text-sm font-medium text-gray-700">${option.emoji || [span_191](start_span)''} ${option.name}</label></div>`;[span_191](end_span)
                            }
                        });
                        [span_192](start_span)dayHTML += `</div>`;[span_192](end_span)
                        
                        dayHTML += `<div class="mt-4">
                            <label for="edit-notes-${dayId}" class="block text-sm font-medium text-gray-700">Anotações</label>
                            <textarea id="edit-notes-${dayId}" name="edit-notes-${dayId}" rows="2" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">${currentNotes}</textarea>
                        [span_193](start_span)</div>`;[span_193](end_span)
                    }
                    
                    [span_194](start_span)dayHTML += `</fieldset>`;[span_194](end_span)
                    formContent.innerHTML += dayHTML;
                });
            } catch (error) {
                [span_195](start_span)console.error("Erro ao abrir modal de edição:", error);[span_195](end_span)
                [span_196](start_span)showToast("Não foi possível carregar os dados do pedido.", 'error');[span_196](end_span)
                [span_197](start_span)modal.classList.add('hidden');[span_197](end_span)
            }
        }

        async function saveOrderChanges(event) {
            [span_198](start_span)event.preventDefault();[span_198](end_span)
            [span_199](start_span)const button = event.target.querySelector('button[type="submit"]');[span_199](end_span)
            button.disabled = true; button.textContent = 'A salvar...';
            const docId = document.getElementById('edit-order-id').value;
            [span_200](start_span)const updateData = {};[span_200](end_span)
            weeklyMenu.forEach(item => {
                if (!item.isHoliday) {
                    const dayId = getDayId(item.day);
                    const selectedOption = document.querySelector(`#edit-order-form input[name="${dayId}"]:checked`);
                    if (selectedOption) { 
                        [span_201](start_span)updateData[dayId] = selectedOption.value;[span_201](end_span)
                    }
                    const notes = document.getElementById(`edit-notes-${dayId}`).value.trim();
                    updateData[`${dayId}_notes`] = notes;
                }
            [span_202](start_span)});[span_202](end_span)
            try {
                [span_203](start_span)await updateDoc(doc(db, "pedidosDaSemana", docId), updateData);[span_203](end_span)
                [span_204](start_span)showToast("Pedido atualizado com sucesso!", 'success');[span_204](end_span)
                document.getElementById('edit-order-modal').classList.add('hidden');
            } catch (error) {
                [span_205](start_span)console.error("Erro ao salvar alterações do pedido:", error);[span_205](end_span)
                [span_206](start_span)showToast("Falha ao salvar as alterações do pedido.", 'error');[span_206](end_span)
            } finally {
                [span_207](start_span)button.disabled = false;[span_207](end_span)
                [span_208](start_span)button.textContent = 'Salvar Alterações';[span_208](end_span)
            }
        }

        function deleteOrder(docId, name) {
            const message = `Tem a certeza que deseja excluir o pedido de ${name}? [span_209](start_span)Esta ação não pode ser desfeita.`;[span_209](end_span)
            showCustomConfirm(message, async () => {
                try {
                    await deleteDoc(doc(db, "pedidosDaSemana", docId));
                    showToast("Pedido excluído com sucesso.", 'success');
                } catch (error) {
                    [span_210](start_span)console.error("Erro ao excluir pedido: ", error);[span_210](end_span)
                    [span_211](start_span)showToast("Falha ao excluir o pedido.", 'error');[span_211](end_span)
                }
            [span_212](start_span)});[span_212](end_span)
        }

        [span_213](start_span)const toBase64 = file => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = error => reject(error); });[span_213](end_span)
        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreview').classList.remove('hidden');
                [span_214](start_span)document.getElementById('image-processor-container').classList.remove('hidden');[span_214](end_span)
            }
            reader.readAsDataURL(file);
        [span_215](start_span)});[span_215](end_span)
        document.getElementById('processImageBtn').addEventListener('click', async () => {
            if (typeof imageCompression === 'undefined') {
                showToast('Erro: Biblioteca de compressão não carregou.', 'error');
                return;
            }

            const loader = document.getElementById('loader'); const button = document.getElementById('processImageBtn'); const confirmationForm = document.getElementById('confirmation-form');
            [span_216](start_span)button.disabled = true; button.textContent = 'A analisar...'; loader.classList.remove('hidden'); confirmationForm.classList.add('hidden');[span_216](end_span)
            const file = document.getElementById('imageUpload').files[0]; 
            const options = { maxSizeMB: 1.5, maxWidthOrHeight: 1500, useWebWorker: true };
            try {
                const compressedFile = await imageCompression(file, options);
                [span_217](start_span)const base64ImageData = await toBase64(compressedFile);[span_217](end_span)
                
                const prompt = `Analise a imagem deste cardápio semanal. Extraia as informações para cada dia (Segunda a Sexta). Para cada dia, identifique o 'Prato Principal', a 'Opção' e a 'Guarnição'. Se um prato for claramente um 'Almoço Especial', adicione a propriedade "isSpecial": true a esse prato. Se o dia for um feriado, marque 'isHoliday' como true. Retorne um objeto JSON seguindo esta estrutura: {"menu": [{"day": "Segunda-feira", "isHoliday": false, "pratoPrincipal": {"name": "Nome", "emoji": "🍛", "isSpecial": true}, "opcao": {"name": "Nome", "emoji": "🥗"}, "guarnicao": {"name": "Nome", "emoji": "🍚"}}, ...]}. Se um campo não existir, retorne o nome como string vazia. Atribua emojis apropriados. [span_218](start_span)O JSON deve ser a única coisa na resposta.`;[span_218](end_span)

                [span_219](start_span)const payload = { contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: compressedFile.type, data: base64ImageData } }] }] };[span_219](end_span)
                [span_220](start_span)const apiKey = firebaseConfig.apiKey;[span_220](end_span)
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`; 

                [span_221](start_span)const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });[span_221](end_span)
                if (!response.ok) { const err = await response.json(); throw new Error(`API Error: ${err.error.message}`); [span_222](start_span)}
                const result = await response.json();[span_222](end_span)
                [span_223](start_span)let textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;[span_223](end_span)
                if (!textResponse) { throw new Error("Resposta da IA vazia ou mal formatada."); [span_224](start_span)}
                
                textResponse = textResponse.replace(/```json/g, '').replace(/```/g, '').trim();[span_224](end_span)
                [span_225](start_span)const menuData = JSON.parse(textResponse);[span_225](end_span)

                if (!menuData || !Array.isArray(menuData.menu)) { throw new Error("Estrutura do JSON da IA inválida."); [span_226](start_span)}
                
                displayConfirmationForm(menuData.menu);[span_226](end_span)
            } catch (error) { 
                [span_227](start_span)console.error("Erro ao processar IA:", error);[span_227](end_span)
                [span_228](start_span)showToast("Erro ao ler imagem com IA: " + error.message, 'error', 8000);[span_228](end_span)
            } finally { 
                [span_229](start_span)button.disabled = false;[span_229](end_span)
                [span_230](start_span)button.textContent = 'Analisar Cardápio'; loader.classList.add('hidden');[span_230](end_span)
            }
        });
        
        function displayConfirmationForm(menuData) {
            [span_231](start_span)const container = document.getElementById('confirmation-form');[span_231](end_span)
            [span_232](start_span)container.innerHTML = '<h3 class="text-xl font-semibold mb-4">Confirme os Dados Extraídos</h3>';[span_232](end_span)
            
            menuData.forEach((item, index) => {
                container.innerHTML += `<div class="p-4 bg-gray-50 rounded-lg mb-4">
                    <h4 class="font-bold">${item.day}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-2">
                        [span_233](start_span)<div><label class="block text-sm font-medium">Prato Principal</label><input type="text" id="prato-${index}" value="${item.pratoPrincipal.name || ''}" class="w-full border rounded p-1"></div>[span_233](end_span)
                        <div><label class="block text-sm font-medium">Opção</label><input type="text" id="opcao-${index}" value="${item.opcao.name || ''}" class="w-full border rounded p-1"></div>
                        <div><label class="block text-sm font-medium">Guarnição</label><input type="text" id="guarnicao-${index}" value="${item.guarnicao.name || ''}" class="w-full border rounded p-1"></div>
                    [span_234](start_span)</div>[span_234](end_span)
                    <div class="mt-2 grid grid-cols-2 gap-4">
                       <label class="flex items-center"><input type="checkbox" id="holiday-${index}" ${item.isHoliday ? [span_235](start_span)'checked' : ''} class="h-4 w-4 rounded border-gray-300 text-indigo-600"> <span class="ml-2 text-sm text-gray-900">Marcar como Feriado</span></label>[span_235](end_span)
                       <label class="flex items-center"><input type="checkbox" id="special-${index}" ${item.pratoPrincipal.isSpecial ? 'checked' : ''} class="h-4 w-4 rounded border-gray-300 text-yellow-600"> <span class="ml-2 text-sm text-gray-900">Almoço Especial</span></label>
                    </div>
                    </div>`;
            [span_236](start_span)});[span_236](end_span)
            [span_237](start_span)container.innerHTML += `<div class="text-center mt-4"><button id="saveNewMenuBtn" class="w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600">Salvar Novo Cardápio</button><button type="button" id="cancelNewMenuBtn" class="w-full mt-2 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400">Cancelar</button></div>`;[span_237](end_span)
            container.classList.remove('hidden'); 
            
            document.getElementById('saveNewMenuBtn').addEventListener('click', () => saveNewMenu(menuData));
            document.getElementById('cancelNewMenuBtn').addEventListener('click', () => {
                container.classList.add('hidden'); document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('image-processor-container').classList.add('hidden'); document.getElementById('imageUpload').value = ''; 
                showToast("Atualização cancelada.", 'info');
            [span_238](start_span)});[span_238](end_span)
        }

        async function saveNewMenu(menuData) {
             [span_239](start_span)const button = document.getElementById('saveNewMenuBtn');[span_239](end_span)
             [span_240](start_span)button.disabled = true; button.textContent = 'A salvar...';[span_240](end_span)
             const newMenu = menuData.map((item, i) => ({ 
                 day: item.day, 
                 pratoPrincipal: { name: document.getElementById(`prato-${i}`).value.trim(), emoji: '🍛', isSpecial: document.getElementById(`special-${i}`).checked }, 
                 opcao: { name: document.getElementById(`opcao-${i}`).value.trim(), emoji: '🥗' }, 
                 [span_241](start_span)guarnicao: { name: document.getElementById(`guarnicao-${i}`).value.trim(), emoji: '🍚' },[span_241](end_span)
                 isHoliday: document.getElementById(`holiday-${i}`).checked
             }));
             try { 
                 [span_242](start_span)await setDoc(menuDocRef, { menu: newMenu });[span_242](end_span)
                 [span_243](start_span)showToast('Cardápio atualizado com sucesso!', 'success');[span_243](end_span)
                 document.getElementById('confirmation-form').classList.add('hidden'); document.getElementById('imagePreview').classList.add('hidden');
                 [span_244](start_span)document.getElementById('image-processor-container').classList.add('hidden'); document.getElementById('imageUpload').value = '';[span_244](end_span)
             } catch (error) { 
                 [span_245](start_span)console.error("Erro ao salvar o cardápio:", error);[span_245](end_span)
                 [span_246](start_span)showToast("Erro ao salvar o novo cardápio.", 'error');[span_246](end_span)
             } finally { 
                 [span_247](start_span)button.disabled = false;[span_247](end_span)
                 [span_248](start_span)button.textContent = 'Salvar Novo Cardápio';[span_248](end_span)
             }
        }
        
        function announceOnWhatsApp() {
            if (!weeklyMenu || weeklyMenu.length === 0) {
                showToast("Cardápio não disponível para anunciar.", "error");
                return;
            }
            
            let message = "*Delícias Urbanas - Cardápio da Semana* 🍽️\n\n";
            weeklyMenu.forEach(item => {
                message += `*${item.day}*\n`;
                if (item.isHoliday) {
                    message += "🎉 _Feriado - Não haverá refeição._\n\n";
                } else {
                    const special = item.pratoPrincipal.isSpecial ? " ⭐" : "";
                    message += `*Prato Principal:* ${item.pratoPrincipal.name}${special}\n`;
                    if (item.opcao.name) message += `*Opção:* ${item.opcao.name}\n`;
                    if (item.guarnicao.name) message += `*Guarnição:* ${item.guarnicao.name}\n`;
                     message += `*Opções Fixas:* Omelete ou Filé de frango\n\n`;
                }
            });
            message += "_Faça seu pedido através do nosso sistema!_";

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        onAuthStateChanged(auth, (user) => {
            if (user && user.uid === APP_CONFIG.ADMIN_UID) {
                showAdminView();
            } else {
                if (!auth.currentUser) {
                    [span_249](start_span)signInAnonymously(auth).catch((error) => {[span_249](end_span)
                        console.error("Erro no login anónimo:", error);
                        showToast("Não foi possível conectar-se. Verifique a sua ligação.", "error");
                    });
                [span_250](start_span)}
                showUserView();
            }
        });
        
        function showUserView() {
            document.getElementById('user-view').classList.remove('hidden');[span_250](end_span)
            [span_251](start_span)document.getElementById('admin-view').classList.add('hidden');[span_251](end_span)
            [span_252](start_span)document.getElementById('admin-login-modal').classList.add('hidden');[span_252](end_span)
            [span_253](start_span)loadAndDisplayMenu();[span_253](end_span)
        }

        function showAdminView() {
            [span_254](start_span)document.getElementById('user-view').classList.add('hidden');[span_254](end_span)
            [span_255](start_span)document.getElementById('admin-view').classList.remove('hidden');[span_255](end_span)
            document.getElementById('admin-login-modal').classList.add('hidden');
            getTotalEmployees();
            loadAdminData();
            loadAndRenderEmployees();
        }

        async function handleAdminLogin(e) {
            [span_256](start_span)e.preventDefault();[span_256](end_span)
            [span_257](start_span)const email = document.getElementById('adminEmail').value;[span_257](end_span)
            [span_258](start_span)const password = document.getElementById('adminPassword').value;[span_258](end_span)
            const btn = e.target.querySelector('button[type="submit"]');
            [span_259](start_span)btn.disabled = true; btn.textContent = 'Entrando...';[span_259](end_span)
            try {
                [span_260](start_span)const userCredential = await signInWithEmailAndPassword(auth, email, password);[span_260](end_span)
                if (userCredential.user.uid !== APP_CONFIG.ADMIN_UID) {
                    [span_261](start_span)await signOut(auth);[span_261](end_span)
                    [span_262](start_span)showToast("Credenciais válidas, mas este usuário não é um administrador.", 'error');[span_262](end_span)
                }
            } catch (error) {
                [span_263](start_span)console.error("Erro no login de administrador:", error);[span_263](end_span)
                const msg = (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') ? "Email ou senha incorretos." [span_264](start_span): "Ocorreu um erro no login.";[span_264](end_span)
                [span_265](start_span)showToast(msg, 'error', 5000);[span_265](end_span)
            } finally {
                [span_266](start_span)btn.disabled = false;[span_266](end_span)
                [span_267](start_span)btn.textContent = 'Entrar';[span_267](end_span)
            }
        }

        async function handleAdminLogout() {
            [span_268](start_span)try { await signOut(auth);[span_268](end_span)
            showToast("Logout de administrador bem-sucedido!", 'info'); [span_269](start_span)}
            catch (error) { console.error("Erro no logout:", error);[span_269](end_span)
            showToast("Erro ao fazer logout.", 'error'); [span_270](start_span)}
        }

        function main() {
            const rgfInput = document.getElementById('employeeRGF');[span_270](end_span)
            rgfInput.value = localStorage.getItem('employeeRGF') || [span_271](start_span)'';[span_271](end_span)
            if(rgfInput.value) { findEmployeeByRGF(rgfInput.value); }
            [span_272](start_span)rgfInput.addEventListener('blur', (e) => { localStorage.setItem('employeeRGF', e.target.value); findEmployeeByRGF(e.target.value); });[span_272](end_span)
            [span_273](start_span)rgfInput.addEventListener('input', validateForm);[span_273](end_span)
            
            document.getElementById('menu').addEventListener('change', validateForm);
            document.getElementById('openConfirmationModal').addEventListener('click', openConfirmationModal);
            document.getElementById('submitOrder').addEventListener('click', submitOrder);
            
            document.querySelectorAll('.cancel-modal-btn, #custom-confirm-cancel-btn').forEach(btn => {
                btn.addEventListener('click', () => btn.closest('.modal-overlay').classList.add('hidden'));
            [span_274](start_span)});[span_274](end_span)
            [span_275](start_span)document.getElementById('switchToAdmin').addEventListener('click', () => document.getElementById('admin-login-modal').classList.remove('hidden'));[span_275](end_span)
            document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
            
            document.getElementById('adminLogoutBtn').addEventListener('click', handleAdminLogout);
            document.getElementById('switchToUserFromAdmin').addEventListener('click', showUserView);
            
            [span_276](start_span)document.getElementById('add-employee-form').addEventListener('submit', handleAddEmployee);[span_276](end_span)
            document.getElementById('employee-list-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('edit-employee-btn')) { openEmployeeEditModal(e.target.dataset.id, e.target.dataset.name); }
                if (e.target.classList.contains('delete-employee-btn')) { handleDeleteEmployee(e.target.dataset.id, e.target.dataset.name); }
            [span_277](start_span)});[span_277](end_span)
            [span_278](start_span)document.getElementById('edit-employee-form').addEventListener('submit', handleSaveEmployeeChanges);[span_278](end_span)
            
            document.getElementById('searchInput').addEventListener('input', () => renderOrdersTable(allOrders));
            document.getElementById('generateReportBtn').addEventListener('click', generateAndPrintReport);
            document.getElementById('announceOnWhatsAppBtn')?.addEventListener('click', announceOnWhatsApp);
            
            document.getElementById('ordersTableContainer').addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-order-btn')) { openOrderEditModal(e.target.dataset.id); }
                if (e.target.classList.contains('delete-order-btn')) { deleteOrder(e.target.dataset.id, e.target.dataset.name); }
            [span_279](start_span)});[span_279](end_span)
            [span_280](start_span)document.getElementById('edit-order-form').addEventListener('submit', saveOrderChanges);[span_280](end_span)
        }

        main();
    </script>
</body>
</html>
